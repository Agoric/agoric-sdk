sequenceDiagram
    title 3 way yield - 3. USDN
    autonumber

    actor trader as trader<br >webUI<br >wallet

    box rgb(255,153,153) Agoric
    participant ymax
    participant flow as flows.openPortfolio
    participant portfolio as portfolio<br/>for trader
    participant LCA
    end

    box rgb(166,184,233) Noble
    participant ICAn
    participant USDN
    end

    %% Notation: ->> for initial message, -->> for consequences

    trader ->> ymax: openPortfolio({give:<br/>{Aave: 3k, Compound: 2k,<br/>USDN: 3K}})
    note left of flow: *TODO(11456):<br/>USDN/USDC ratio

    ymax -->> flow: (seat, ...*)

    flow -->> portfolio: make
    activate portfolio

    flow -->> ICAn: makeAccount
    activate ICAn
    ICAn -->> flow: ack

    flow -->> portfolio: add(ICAn)

    flow -->> LCA: localTransfer(3K)
    flow -->> LCA: transfer(3K USDC, ICAn)
    LCA -->> ICAn: 3k USDC
    ICAn -->> portfolio: ack

    flow -->> ICAn: executeEncodedTx(<br/>[MsgSwap(3K),MsgLock(3K*)])
    note left of ICAn: *TODO(11456):<br/>USDN/USDC ratio
    ICAn -->> USDN: [MsgSwap(3K),MsgLock(3K*)]
    USDN -->> ICAn: ack
    ICAn -->> flow: ack
    flow -->> trader: { invitationMakers,<br/>topics: ... noble1xyz }

    deactivate ICAn
    deactivate portfolio
