# Snapshot report for `test/evm-wallet-handler.test.ts`

The actual snapshot is saved in `evm-wallet-handler.test.ts.snap`.

Generated by [AVA](https://avajs.dev).

## handleOperation - openPortfolio

> Portfolio IDs

    [
      1n,
    ]

> Calls

    {
      deposit: [],
      openPortfolioFromEVM: [
        [
          {
            allocations: [
              {
                instrument: 'inst1',
                portion: 100n,
              },
            ],
          },
          {
            amount: 1000000n,
            chainId: 42161n,
            permit2Payload: {
              owner: '0xOwnerAddress',
              permit: {
                deadline: 1700000000n,
                nonce: 123n,
                permitted: {
                  amount: 1000000n,
                  token: '0xaf88d065e77c8cC2239327C5EDb3A432268e5831',
                },
              },
              signature: '0xSignatureData',
              witness: '0xWitnessData',
              witnessTypeString: 'WitnessTypeString',
            },
            spender: '0xSpenderAddress',
            token: '0xaf88d065e77c8cC2239327C5EDb3A432268e5831',
          },
        ],
      ],
      rebalance: [],
      withdraw: [],
    }

> Published Statuses

    [
      {
        deadline: 1700000000n,
        nonce: 123n,
        status: 'pending',
        updated: 'messageUpdate',
      },
      {
        deadline: 1700000000n,
        nonce: 123n,
        result: 'portfolio1',
        status: 'ok',
        updated: 'messageUpdate',
      },
    ]

## handleOperation - openPortfolio requires permitDetails

> Portfolio IDs

    []

> Calls

    {
      deposit: [],
      openPortfolioFromEVM: [],
      rebalance: [],
      withdraw: [],
    }

> Published Statuses

    [
      {
        deadline: 1700000000n,
        nonce: 123n,
        status: 'pending',
        updated: 'messageUpdate',
      },
      {
        deadline: 1700000000n,
        error: 'Error: Missing permit details for OpenPortfolio operation',
        nonce: 123n,
        status: 'error',
        updated: 'messageUpdate',
      },
    ]

## handleOperation invokes withdraw with correct parameters

> Portfolio IDs

    [
      42n,
    ]

> Calls

    {
      deposit: [],
      openPortfolioFromEVM: [],
      rebalance: [],
      withdraw: [
        [
          {
            domain: {
              chainId: 42161n,
              name: 'Ymax',
              version: '1',
            },
            withdrawDetails: {
              amount: 1000000n,
              token: '0xaf88d065e77c8cC2239327C5EDb3A432268e5831',
            },
          },
        ],
      ],
    }

> Published Statuses

    [
      {
        deadline: 1700000000n,
        nonce: 123n,
        status: 'pending',
        updated: 'messageUpdate',
      },
      {
        deadline: 1700000000n,
        nonce: 123n,
        result: 'withdraw-flow',
        status: 'ok',
        updated: 'messageUpdate',
      },
    ]

## handleOperation fails for unknown portfolio

> Portfolio IDs

    []

> Calls

    {
      deposit: [],
      openPortfolioFromEVM: [],
      rebalance: [],
      withdraw: [],
    }

> Published Statuses

    [
      {
        deadline: 1700000000n,
        nonce: 789n,
        status: 'pending',
        updated: 'messageUpdate',
      },
      {
        deadline: 1700000000n,
        error: 'Error: key "[999n]" not found in collection "test4_testPortfolios"',
        nonce: 789n,
        status: 'error',
        updated: 'messageUpdate',
      },
    ]
