# Snapshot report for `test/deposit-tools.test.ts`

The actual snapshot is saved in `deposit-tools.test.ts.snap`.

Generated by [AVA](https://avajs.dev).

## handleDeposit works with mocked dependencies

> Snapshot 1

    {
      policyVersion: 4,
      rebalanceCount: 2,
      steps: [
        {
          amount: {
            brand: Object @Alleged: mock brand {},
            value: 1000n,
          },
          dest: '@agoric',
          src: '<Deposit>',
        },
        {
          amount: {
            brand: Object @Alleged: mock brand {},
            value: 1000n,
          },
          dest: '@noble',
          src: '@agoric',
        },
        {
          amount: {
            brand: Object @Alleged: mock brand {},
            value: 475n,
          },
          dest: 'USDN',
          detail: {
            amountOut: 473n,
          },
          src: '@noble',
        },
        {
          amount: {
            brand: Object @Alleged: mock brand {},
            value: 525n,
          },
          dest: '@Arbitrum',
          detail: {
            evmGas: 3n,
          },
          fee: {
            brand: Object @Alleged: fee brand (BLD) {},
            value: 3628305n,
          },
          src: '@noble',
        },
        {
          amount: {
            brand: Object @Alleged: mock brand {},
            value: 305n,
          },
          dest: 'Aave_Arbitrum',
          fee: {
            brand: Object @Alleged: fee brand (BLD) {},
            value: 830427n,
          },
          src: '@Arbitrum',
        },
        {
          amount: {
            brand: Object @Alleged: mock brand {},
            value: 220n,
          },
          dest: 'Compound_Arbitrum',
          fee: {
            brand: Object @Alleged: fee brand (BLD) {},
            value: 830427n,
          },
          src: '@Arbitrum',
        },
      ],
    }

## handleDeposit handles different position types correctly

> Snapshot 1

    [
      {
        amount: {
          brand: Object @Alleged: mock brand {},
          value: 1000n,
        },
        dest: '@agoric',
        src: '<Deposit>',
      },
      {
        amount: {
          brand: Object @Alleged: mock brand {},
          value: 1000n,
        },
        dest: '@noble',
        src: '@agoric',
      },
      {
        amount: {
          brand: Object @Alleged: mock brand {},
          value: 431n,
        },
        dest: 'USDN',
        detail: {
          amountOut: 429n,
        },
        src: '@noble',
      },
      {
        amount: {
          brand: Object @Alleged: mock brand {},
          value: 65n,
        },
        dest: 'USDNVault',
        detail: {
          amountOut: 63n,
        },
        src: '@noble',
      },
      {
        amount: {
          brand: Object @Alleged: mock brand {},
          value: 306n,
        },
        dest: '@Avalanche',
        detail: {
          evmGas: 3n,
        },
        fee: {
          brand: Object @Alleged: fee brand (BLD) {},
          value: 3628305n,
        },
        src: '@noble',
      },
      {
        amount: {
          brand: Object @Alleged: mock brand {},
          value: 198n,
        },
        dest: '@Ethereum',
        detail: {
          evmGas: 3n,
        },
        fee: {
          brand: Object @Alleged: fee brand (BLD) {},
          value: 3628305n,
        },
        src: '@noble',
      },
      {
        amount: {
          brand: Object @Alleged: mock brand {},
          value: 198n,
        },
        dest: 'Compound_Ethereum',
        fee: {
          brand: Object @Alleged: fee brand (BLD) {},
          value: 830427n,
        },
        src: '@Ethereum',
      },
      {
        amount: {
          brand: Object @Alleged: mock brand {},
          value: 306n,
        },
        dest: 'Aave_Avalanche',
        fee: {
          brand: Object @Alleged: fee brand (BLD) {},
          value: 830427n,
        },
        src: '@Avalanche',
      },
    ]

## planRebalanceToAllocations moves funds when needed

> Snapshot 1

    [
      {
        amount: {
          brand: Object @Alleged: mock brand {},
          value: 600n,
        },
        dest: '@noble',
        src: 'USDN',
      },
      {
        amount: {
          brand: Object @Alleged: mock brand {},
          value: 600n,
        },
        dest: '@Arbitrum',
        detail: {
          evmGas: 3n,
        },
        fee: {
          brand: Object @Alleged: fee brand (BLD) {},
          value: 3628305n,
        },
        src: '@noble',
      },
      {
        amount: {
          brand: Object @Alleged: mock brand {},
          value: 400n,
        },
        dest: 'Aave_Arbitrum',
        fee: {
          brand: Object @Alleged: fee brand (BLD) {},
          value: 830427n,
        },
        src: '@Arbitrum',
      },
      {
        amount: {
          brand: Object @Alleged: mock brand {},
          value: 200n,
        },
        dest: 'Compound_Arbitrum',
        fee: {
          brand: Object @Alleged: fee brand (BLD) {},
          value: 830427n,
        },
        src: '@Arbitrum',
      },
    ]

## planWithdrawFromAllocations withdraws and rebalances

> Snapshot 1

    [
      {
        amount: {
          brand: Object @Alleged: mock brand {},
          value: 1600n,
        },
        dest: '@noble',
        src: 'USDN',
      },
      {
        amount: {
          brand: Object @Alleged: mock brand {},
          value: 600n,
        },
        dest: '@Arbitrum',
        detail: {
          evmGas: 3n,
        },
        fee: {
          brand: Object @Alleged: fee brand (BLD) {},
          value: 3628305n,
        },
        src: '@noble',
      },
      {
        amount: {
          brand: Object @Alleged: mock brand {},
          value: 1000n,
        },
        dest: '@agoric',
        src: '@noble',
      },
      {
        amount: {
          brand: Object @Alleged: mock brand {},
          value: 400n,
        },
        dest: 'Aave_Arbitrum',
        fee: {
          brand: Object @Alleged: fee brand (BLD) {},
          value: 830427n,
        },
        src: '@Arbitrum',
      },
      {
        amount: {
          brand: Object @Alleged: mock brand {},
          value: 200n,
        },
        dest: 'Compound_Arbitrum',
        fee: {
          brand: Object @Alleged: fee brand (BLD) {},
          value: 830427n,
        },
        src: '@Arbitrum',
      },
      {
        amount: {
          brand: Object @Alleged: mock brand {},
          value: 1000n,
        },
        dest: '<Cash>',
        src: '@agoric',
      },
    ]

## planWithdrawFromAllocations with no target preserves relative amounts

> Snapshot 1

    [
      {
        amount: {
          brand: Object @Alleged: mock brand {},
          value: 400n,
        },
        dest: '@Arbitrum',
        fee: {
          brand: Object @Alleged: fee brand (BLD) {},
          value: 830427n,
        },
        src: 'Aave_Arbitrum',
      },
      {
        amount: {
          brand: Object @Alleged: mock brand {},
          value: 200n,
        },
        dest: '@Arbitrum',
        fee: {
          brand: Object @Alleged: fee brand (BLD) {},
          value: 830427n,
        },
        src: 'Compound_Arbitrum',
      },
      {
        amount: {
          brand: Object @Alleged: mock brand {},
          value: 600n,
        },
        dest: '@noble',
        fee: {
          brand: Object @Alleged: fee brand (BLD) {},
          value: 830427n,
        },
        src: '@Arbitrum',
      },
      {
        amount: {
          brand: Object @Alleged: mock brand {},
          value: 400n,
        },
        dest: '@noble',
        src: 'USDN',
      },
      {
        amount: {
          brand: Object @Alleged: mock brand {},
          value: 1000n,
        },
        dest: '@agoric',
        src: '@noble',
      },
      {
        amount: {
          brand: Object @Alleged: mock brand {},
          value: 1000n,
        },
        dest: '<Cash>',
        src: '@agoric',
      },
    ]
